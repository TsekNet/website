!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.kvStoragePolyfill=t()}(this,function(){const e=function(){function e(){}return e.prototype.then=function(n,r){const o=new e,i=this.s;if(i){const e=1&i?n:r;if(e){try{t(o,1,e(this.v))}catch(e){t(o,2,e)}return o}return this}return this.o=function(e){try{const i=e.v;1&e.s?t(o,1,n?n(i):i):r?t(o,1,r(i)):t(o,2,i)}catch(e){t(o,2,e)}},o},e}();function t(n,r,o){if(!n.s){if(o instanceof e){if(!o.s)return void(o.o=t.bind(null,n,r));1&r&&(r=o.s),o=o.v}if(o&&o.then)return void o.then(t.bind(null,n,r),t.bind(null,n,2));n.s=r,n.v=o;const i=n.o;i&&i(n)}}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var n=0,r="function"==typeof WeakMap?WeakMap:function(){var e="function"==typeof Symbol?Symbol(0):"__weak$"+ ++n;this.set=function(t,n){t[e]=n},this.get=function(t){return t[e]}};function o(e,t){return new Promise(function(n,r){e.onsuccess=function(){var r=e.result;t&&(r=t(r)),n(r)},e.onerror=function(){r(e.error)}})}function i(e,t){return o(e.openCursor(t),function(e){return e?[e.key,e.value]:[]})}function u(e){return new Promise(function(t,n){e.oncomplete=function(){t()},e.onabort=function(){n(e.error)},e.onerror=function(){n(e.error)}})}function f(e){if(!function(e){if("number"==typeof e||"string"==typeof e)return!0;if("object"==typeof e&&e){if(Array.isArray(e))return!0;if("setUTCFullYear"in e)return!0;if("function"==typeof ArrayBuffer&&ArrayBuffer.isView(e))return!0;if("byteLength"in e&&"length"in e)return!0}return!1}(e))throw Error("kv-storage: The given value is not allowed as a key")}var c={};function s(e,t){return i(e,a(t))}function a(e){return e===c?IDBKeyRange.lowerBound(-Infinity):IDBKeyRange.lowerBound(e,!0)}var l=new r,v=new r,h=new r,y=new r,d=function(){};function p(n,r){return r(function(r,o){try{function u(){return v.set(n,c),h.set(n,void 0),{value:d,done:void 0===c}}var f=v.get(n);if(void 0===f)return Promise.resolve({value:void 0,done:!0});var c,l,d,p=function(n,r){var o,i=-1;e:{for(var u=0;u<r.length;u++){var f=r[u][0];if(f){var c=f();if(c&&c.then)break e;if(c===n){i=u;break}}else i=u}if(-1!==i){do{for(var s=r[i][1];!s;)s=r[++i][1];var a=s();if(a&&a.then){o=!0;break e}var l=r[i][2];i++}while(l&&!l());return a}}const v=new e,h=t.bind(null,v,2);return(o?a.then(y):c.then(function e(o){for(;;){if(o===n){i=u;break}if(++u===r.length){if(-1!==i)break;return void t(v,1,s)}if(f=r[u][0]){if((o=f())&&o.then)return void o.then(e).then(void 0,h)}else i=u}do{for(var c=r[i][1];!c;)c=r[++i][1];var s=c();if(s&&s.then)return void s.then(y).then(void 0,h);var a=r[i][2];i++}while(a&&!a());t(v,1,s)})).then(void 0,h),v;function y(e){for(;;){var n=r[i][2];if(!n||n())break;for(var o=r[++i][1];!o;)o=r[++i][1];if((e=o())&&e.then)return void e.then(y).then(void 0,h)}t(v,1,e)}}(y.get(n),[[function(){return"keys"},function(){return Promise.resolve(function(e,t){return i(e,a(t)).then(function(e){return e[0]})}(o,f)).then(function(e){d=c=e})}],[function(){return"values"},function(){return Promise.resolve(s(o,f)).then(function(e){var t;c=(t=e)[0],d=l=t[1]})}],[function(){return"entries"},function(){return Promise.resolve(s(o,f)).then(function(e){var t;l=(t=e)[1],d=void 0===(c=t[0])?void 0:[c,l]})}]]);return Promise.resolve(p&&p.then?p.then(u):u())}catch(e){return Promise.reject(e)}})}function m(e,t){var n=new d;return y.set(n,e),l.set(n,t),v.set(n,c),h.set(n,void 0),n}d.prototype.return=function(){v.set(this,void 0)},d.prototype.next=function(){var e=this,t=l.get(this);if(!t)return Promise.reject(new TypeError("Invalid this value"));var n,r=h.get(this);return n=void 0!==r?r.then(function(){return p(e,t)}):p(this,t),h.set(this,n),n},"function"==typeof Symbol&&Symbol.asyncIterator&&(d.prototype[Symbol.asyncIterator]=function(){return this});var b=function(e,t,n){try{return null===w.get(e)&&function(e){var t=g.get(e);w.set(e,new Promise(function(n,r){var o=self.indexedDB.open(t,1);o.onsuccess=function(){var i=o.result;(function(e,t,n){if(1!==e.objectStoreNames.length)return n(j(t)),!1;if(e.objectStoreNames[0]!==S)return n(j(t)),!1;var r=e.transaction(S,"readonly").objectStore(S);return!(r.autoIncrement||r.keyPath||r.indexNames.length)||(n(j(t)),!1)})(i,t,r)&&(i.onclose=function(){w.set(e,null)},i.onversionchange=function(){i.close(),w.set(e,null)},n(i))},o.onerror=function(){return r(o.error)},o.onupgradeneeded=function(){try{o.result.createObjectStore(S)}catch(e){r(e)}}}))}(e),Promise.resolve(w.get(e)).then(function(e){var r=e.transaction(S,t),o=r.objectStore(S);return n(r,o)})}catch(e){return Promise.reject(e)}},g=new r,w=new r,S="store",P=function(e){var t="kv-storage:"+e;w.set(this,null),g.set(this,t),this.backingStore={database:t,store:S,version:1}};P.prototype.set=function(e,t){try{return f(e),b(this,"readwrite",function(n,r){return void 0===t?r.delete(e):r.put(t,e),u(n)})}catch(e){return Promise.reject(e)}},P.prototype.get=function(e){try{return f(e),b(this,"readonly",function(t,n){return o(n.get(e))})}catch(e){return Promise.reject(e)}},P.prototype.delete=function(e){try{return f(e),b(this,"readwrite",function(t,n){return n.delete(e),u(t)})}catch(e){return Promise.reject(e)}},P.prototype.clear=function(){try{var e=this;function t(){function t(){return o(self.indexedDB.deleteDatabase(g.get(e)))}var r=function(){if(n){try{n.close()}catch(e){}return Promise.resolve(new Promise(setTimeout)).then(function(){})}}();return r&&r.then?r.then(t):t()}var n,r=w.get(e),i=function(){if(null!==r){function t(){w.set(e,null)}var o=function(e,t){try{var o=Promise.resolve(r).then(function(e){n=e})}catch(e){return}return o&&o.then?o.then(void 0,function(){}):o}();return o&&o.then?o.then(t):t()}}();return Promise.resolve(i&&i.then?i.then(t):t())}catch(e){return Promise.reject(e)}},P.prototype.keys=function(){var e=this;return m("keys",function(t){return b(e,"readonly",t)})},P.prototype.values=function(){var e=this;return m("values",function(t){return b(e,"readonly",t)})},P.prototype.entries=function(){var e=this;return m("entries",function(t){return b(e,"readonly",t)})},"function"==typeof Symbol&&Symbol.asyncIterator&&(P.prototype[Symbol.asyncIterator]=P.prototype.entries);var k=new P("default");function j(e){return new Error('kv-storage: database "'+e+'" corrupted')}return k.default=k,k.StorageArea=P,k});
//# sourceMappingURL=kv-storage-polyfill.umd.js.map
